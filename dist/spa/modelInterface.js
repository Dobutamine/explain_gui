const mode={APPEND:"append",REFRESH:"refresh"};export class ModelInterface{definition={};engine={};data=[];properties={};loadedModelName="";dataMode=mode.REFRESH;constructor(e){e||(e="normal_neonate"),this.loadedModelName=e,this.engine=new Worker("./explain_engine/engine.js"),this.loadModelDefinition(e),this.engine.addEventListener("message",(e=>{this._receiveMessageFromModel(e.data)}))}loadModelDefinition=e=>{e="./explain_engine/definitions/"+e+".json";let t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",e,!0),t.onreadystatechange=()=>{4==t.readyState&&"200"==t.status&&(this.definition=JSON.parse(t.responseText),this.engine&&this.engine.postMessage({type:"cmd",target:null,action:"load",data:this.definition,return_tag:null}))},t.send(null)};getCurrentLoadedModelName=()=>this.loadedModelName;setDataloggerInterval=e=>{this.engine.postMessage({type:"set",target:"datalogger",action:"setUpdateInterval",data:e,return_tag:null})};setDataloggerWatchedModels=e=>{this.engine.postMessage({type:"set",target:"datalogger",action:"setWatchedModels",data:e,return_tag:null})};setDataloggerWatchedModelsRT=e=>{this.engine.postMessage({type:"set",target:"datalogger",action:"setWatchedModelsRT",data:e,return_tag:null})};setModelState=e=>{this.engine.postMessage({type:"set",target:"datalogger",action:"setModelState",data:e,return_tag:null})};setPropertyDirect=(e,t,a)=>{this.engine.postMessage({type:"set_direct",target:e,action:t,data:a})};setPropertyByFunction=(e,t,a)=>{this.engine.postMessage({type:"set",target:e,action:t,data:a})};setProperty=(e,t,a,s=0,n=0,o="abs")=>{this.engine.postMessage({type:"set",target:"interventions",action:"addPropertyChange",data:{model:e,property:t,target:a,in_time:s,at_time:n,mode:o,label:e+t+" change"},return_tag:null})};getModelJSON=()=>{this.engine.postMessage({type:"get",target:"datalogger",action:"getModelJSON",data:null,return_tag:"json"})};getModelState=()=>{this.engine.postMessage({type:"get",target:"datalogger",action:"getModelStateFull",data:null,return_tag:"state"})};getModelDefinition=e=>{this.engine.postMessage({type:"get",target:"model_definition",action:"null",data:null,return_tag:"model_definition"})};getProperties=e=>{this.engine.postMessage({type:"get",target:"datalogger",action:"getModelProps",data:e,return_tag:"props"})};startModel=()=>{this.clearData(),this.engine.postMessage({type:"cmd",target:null,action:"start",data:null,return_tag:null})};stopModel=()=>{this.engine.postMessage({type:"cmd",target:null,action:"stop",data:null,return_tag:null})};fastForwardModel=e=>{this.engine.postMessage({type:"cmd",target:null,action:"goto",data:e,return_tag:null})};calculateModel=e=>{this.dataMode!==mode.APPEND&&this.clearData(),this.engine.postMessage({type:"cmd",target:null,action:"calculate",data:e,return_tag:null})};clearData=()=>{this.data=[]};_receiveMessageFromModel=e=>{switch(e.type){case"mes":break;case"data":switch(e.target){case"datalogger_output":this.data=e.data;break;case"state":this.snapshot=e.data;break;case"props":this.properties=e.data;default:break}break;case"rt":break;default:break}}}