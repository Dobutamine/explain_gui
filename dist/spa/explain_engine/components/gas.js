class Gas{constructor(t){this._model=t,this.temp=20,this.fractions=[],this.concentrations=[],this.partialpressures=[],this._no_compounds=0,this.initialized=!1,this.counter=0}modelStep(){this.is_enabled&&this.modelCycle()}modelCycle(){}initializeGasCompartment(t){this.initialized||(Object.keys(this.dry_air).forEach((t=>{this.fractions.push(t);const i=t.replace("f","c");this.concentrations.push(i);const s=t.replace("f","p");this.partialpressures.push(s)})),this._no_compounds=this.fractions.length),"gas_compartment"===t.subtype&&(this.calcGasCompositionFromFractions(t),t.initialized=!0),this.initialized=!0}calcGasCompositionFromFractions(t){let i=this._model.components.metabolism["p_atm"];this.temp=this.getTemperature(t),t.ctotal=i*t.vol/(this.gas_constant*(273.15+this.temp))/t.vol*1e3,t["ch2o"]=t["fh2o"]*t.ctotal,t["ph2o"]=t["fh2o"]*i;for(let s=0;s<this._no_compounds;s++)t[this.fractions[s]]=this.dry_air[this.fractions[s]]-this.dry_air[this.fractions[s]]*t["fh2o"];for(let s=0;s<this._no_compounds;s++)t[this.concentrations[s]]=t[this.fractions[s]]*t.ctotal,t[this.partialpressures[s]]=t[this.fractions[s]]*i}calcGasComposition(t){if(this.is_enabled)if(t.initialized||this.initializeGasCompartment(t),t.fixed_composition)this.calcGasCompositionFromFractions(t);else{this.temp=this.getTemperature(t),t.ctotal=t.pres*t.vol/(this.gas_constant*(273.15+this.temp))/t.vol*1e3,t["ch2o"]=t["fh2o"]*t.ctotal,t["ph2o"]=t["fh2o"]*t.pres;for(let i=0;i<this._no_compounds;i++)t[this.fractions[i]]=t[this.concentrations[i]]/t.ctotal,t[this.fractions[i]]=t[this.fractions[i]]-t[this.fractions[i]]*t["fh2o"],t[this.partialpressures[i]]=t[this.fractions[i]]*t.pres}}calcGasMixing(t,i,s){if(i.initialized&s.initialized&&this.is_enabled)for(let o=0;o<this._no_compounds;o++){const e=t*(s[this.concentrations[o]]-i[this.concentrations[o]]);i[this.concentrations[o]]=(i[this.concentrations[o]]*i.vol+e)/i.vol}}getTemperature(t){let i=20;switch(t.temp_source){case"room":i=this._model.components.metabolism.outside_temp;break;case"body":i=this._model.components.metabolism.body_temp;break}return i}}