class Blood{constructor(i){this._model=i,this.compound_names=[],this.no_compounds=0,this.initialized=!1}modelStep(){this.is_enabled&&this.modelCycle()}modelCycle(){}calcBloodComposition(i){this.is_enabled&&(i.initialized?this.calcEnergyUse(i):this.initializeBloodCompartment(i))}initializeBloodCompartment(i){this.initialized||(Object.keys(this.compounds).forEach((i=>{this.compound_names.push(i)})),this.no_compounds=this.compound_names.length,this.initialized=!0),this.compound_names.forEach((o=>{i[o]=this.compounds[o]})),i.initialized=!0}calcBloodMixing(i,o,t){this.is_enabled&&o.initialized&&t.initialized&&this.compound_names.forEach((e=>{const s=(t[e]-o[e])*i;o[e]=(o[e]*o.vol+s)/o.vol,o[e]<0&&(o[e]=0)}))}calcEnergyUse(i){const o=i.fvatp;if(o>0){let t=o*this._model.components.metabolism.atp_need,e=t*this._model.modeling_stepsize,s=i.to2*i.vol,l=.8*s,n=e/5,c=5*(n-l/4);c<0&&(c=0);let d=n;n>l&&(d=l),s-=d,i.to2=s/i.vol,i.to2<0&&(i.to2=0);let m=d*this._model.components.metabolism.resp_q;i.tco2=(i.tco2*i.vol+m)/i.vol,i.tco2<0&&(i.tco2=0)}}}