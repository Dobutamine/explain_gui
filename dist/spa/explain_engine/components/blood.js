class Blood{constructor(o){this._model=o,this.compound_names=[],this.no_compounds=0,this.initialized=!1}modelStep(){this.is_enabled&&this.modelCycle()}modelCycle(){}calcBloodComposition(o){this.is_enabled&&(o.initialized?this.calcEnergyUse(o):this.initializeBloodCompartment(o))}initializeBloodCompartment(o){this.initialized||(Object.keys(this.compounds).forEach((o=>{this.compound_names.push(o)})),this.no_compounds=this.compound_names.length,this.initialized=!0),this.compound_names.forEach((i=>{o[i]=this.compounds[i]})),o.initialized=!0}calcBloodMixing(o,i,t){if(this.is_enabled&&i.initialized&&t.initialized)for(let e=0;e<this.no_compounds;e++){const s=this.compound_names[e];let n=i[s];const l=i.vol,c=t[s],d=(c-n)*o;n=(n*l+d)/l,n<0&&(n=0),i[s]=n}}calcEnergyUse(o){const i=o.fvatp;if(i>0){let t=i*this._model.components.metabolism.atp_need,e=t*this._model.modeling_stepsize,s=o.to2*o.vol,n=.8*s,l=e/5,c=5*(l-n/4);c<0&&(c=0);let d=l;l>n&&(d=n),s-=d,o.to2=s/o.vol,o.to2<0&&(o.to2=0);let m=d*this._model.components.metabolism.resp_q;o.tco2=(o.tco2*o.vol+m)/o.vol,o.tco2<0&&(o.tco2=0)}}}