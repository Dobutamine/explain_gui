class Breathing{constructor(t){this._model=t,this._amp=8,this._temp_min_volume=1e4,this._temp_max_volume=-1e4,this._volume_time_counter=0,this._breath_timer_period=0,this._breath_timer_counter=0,this.tidal_volume=0,this.minute_volume=0}calculateVolumes(){this.tidal_volume=this._temp_max_volume-this._temp_min_volume,this.minute_volume=this.tidal_volume*this.spont_resp_rate,this._temp_min_volume=1e4,this._temp_max_volume=-1e4,this._volume_time_counter=0}generateMuscleSignal(){return-this._amp*Math.exp(Math.pow(this._breath_timer_counter-this.breath_duration/2,2)/Math.pow(this.breath_duration,2)*-25)}vtrrController(){this.spont_resp_rate=Math.sqrt(this.target_minute_volume/this.vtrr_ratio),this.target_tidal_volume=this.target_minute_volume/this.spont_resp_rate}startBreath(){this.calculateVolumes();let t=this.tidal_volume-this.target_tidal_volume;t<-1e-4&&(this._amp-=.1*t*1e3,this._amp>this.max_amp&&(this._amp=this.max_amp)),t>1e-4&&(this._amp-=.1*t*1e3,this._amp<0&&(this._amp=0)),this.measured_spont_breath_freq=60/this.measured_spont_breath_counter,this.measured_spont_breath_counter=0,this.measured_spont_updater_counter=0,this._breath_timer_counter=1}modelStep(){this.is_enabled&&this.modelCycle()}modelCycle(){this.spont_resp_rate>0&&this.spont_breathing_enabled?this._breath_timer_period=6e4/this.spont_resp_rate:this._breath_timer_period=6e4,this.vtrrController(),this._breath_timer_counter>this._breath_timer_period&&this.startBreath(),this.spont_resp_rate>0&&this.spont_breathing_enabled?this.resp_muscle_pressure=this.generateMuscleSignal():this.resp_muscle_pressure=0,this._model.components["CHEST_L"].pres_ext=this.resp_muscle_pressure,this._model.components["CHEST_R"].pres_ext=this.resp_muscle_pressure;let t=this._model.components["ALL"].vol+this._model.components["ALR"].vol;t>this._temp_max_volume&&(this._temp_max_volume=t),t<this._temp_min_volume&&(this._temp_min_volume=t),this._volume_time_counter+=this._model.modeling_stepsize,this._volume_time_counter>5&&this.calculateVolumes(),this._breath_timer_counter+=1e3*this._model.modeling_stepsize}}