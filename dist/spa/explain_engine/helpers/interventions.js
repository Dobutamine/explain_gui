class Interventions{constructor(e){this._model=e,this.propertyChanges=[],this.annotations={},this._current_model_time=0}sendMessage=(e,t,o,s,r)=>{postMessage({type:e,target:t,action:o,data:s,return_tag:r})};clearAnnotations(){this.annotations={}}clearPropertyChanges(){this.propertyChanges=[]}addPropertyChange(e){let t=e.model;"object"!=typeof e.model&&(t=[e.model]),t.forEach((t=>{let o={},s=t,r=e.property;Object.assign(o,e),o.property=r,o.model=t,o.property_type=-1,o.property_loc="none",o.started=!1,o.completed=!1,o.at_time=e.at_time+this._current_model_time;try{void 0!=this._model.components[s][r]&&(o.property_loc="components",o.property_type=typeof this._model.components[s][r])}catch(a){}try{void 0!=this._model[r]&&(o.property_loc="general",o.property_type=typeof this._model[r])}catch(a){}this.propertyChanges.push(o);let n=`${o.model}.${o.property} changes to ${o.target} in ${o.in_time.toFixed(0)} sec. at ${o.at_time.toFixed(0)} sec.`;sendMessage("mes",null,null,[n]),sendMessage("mes",null,null,["ready"])}))}getAnnotations(){return this.annotations}modelStep(e){this._current_model_time=e,this.propertyChanges.forEach((t=>{this.processIntervention(t,e)}))}startPropertyChange(e,t){switch(e["started"]=!0,e.property_type){case"string":this._model[e.property_loc][e.model][e.property]=e.target,e.completed=!0,this.annotations["text"]="start "+e.label,this.sendMessage("mes",null,null,[`switched ${e.model}.${e.property} to ${e.target} at ${Math.round(t)} sec.`]);break;case"boolean":this._model[e.property_loc][e.model][e.property]=e.target,e.completed=!0,this.annotations["text"]="start "+e.label,this.sendMessage("mes",null,null,[`switched ${e.model}.${e.property} to ${e.target} at ${Math.round(t)} sec.`]);break;case"number":switch(e.mode){case"rel":e.target=this._model[e.property_loc][e.model][e.property]*e.target,e["stepsize"]=(e.target-this._model[e.property_loc][e.model][e.property])/e.in_time*this._model.modeling_stepsize;break;case"abs":e["stepsize"]=(e.target-this._model[e.property_loc][e.model][e.property])/e.in_time*this._model.modeling_stepsize;break;default:console.log("no intervention mode set");break}e["no_steps"]=e.in_time/this._model.modeling_stepsize,this.sendMessage("mes",null,null,[`start intervention on ${e.model}.${e.property} at ${Math.round(t)} sec.`]),this.annotations["text"]="start "+e.label;break;default:console.log(e.property_type);break}}processPropertyChange(e,t){e.started&!e.completed&&(this._model[e.property_loc][e.model][e.property]+=e.stepsize,e.no_steps-=1,e.no_steps<=0&&(e.completed=!0,e.stepsize=0,this.sendMessage("mes",null,null,[`finished intervention on ${e.model}.${e.property} at ${Math.round(t)} sec.`]),this.annotations["text"]="end "+e.label))}processIntervention(e,t){t>=e["at_time"]&!e["started"]&&this.startPropertyChange(e,t),this.processPropertyChange(e,t)}}